var App;function Task(e,t,o,n){var a=this,s=e;App.newDate();a.id=ko.computed(function(){return s}),a.name=ko.observable(t),a.complete=ko.observable(o),a.completeYesterday=ko.observable(n),a.isUrl=ko.computed(function(){return e=a.name(),!!new RegExp("(http|ftp|https)://[w-]+(.[w-]+)+([w.,@?^=%&amp;:/~+#-]*[w@?^=%&amp;/~+#-])?").test(e);var e}),a.toJSON=function(){return{Id:a.id(),Name:a.name(),Complete:a.complete(),CompleteYesterday:a.completeYesterday()}}}function AppModel(e,t){"use strict";var n=this,o=App.newDate(),a=new Date(o);a=new Date(a.setDate(o.getDate()-1)),n.tasks=ko.observableArray([]),n.listDateMS=null!==e&&e.listDateMS?e.listDateMS:o.getTime(),n.listDate=ko.computed(function(){return new Date(n.listDateMS)}),n.yesterdayComplete=0,n.previousTaskTotal=0,n.listDate().toLocaleDateString()!==o.toLocaleDateString()&&(n.listDate().toLocaleDateString()===a.toLocaleDateString()?null!==e&&0<e.tasks.length&&$.each(e.tasks,function(e,t){t.CompleteYesterday=t.Complete,t.Complete=!1}):null!==e&&0<e.tasks.length&&$.each(e.tasks,function(e,t){t.Complete=!1,t.CompleteYesterday=!1})),n.listDateMS=o.getTime(),null!==e&&0<e.tasks.length&&$.each(e.tasks,function(e,t){var o=new Task(t.Id,t.Name,t.Complete,t.CompleteYesterday);n.previousTaskTotal++,t.CompleteYesterday&&n.yesterdayComplete++,n.tasks.push(o)}),n.allComplete=ko.computed(function(){var o=!0;return $.each(n.tasks(),function(e,t){!1===t.complete()&&(o=!1)}),o}),n.tasksComplete=ko.computed(function(){var o=0;return $.each(n.tasks(),function(e,t){!0===t.complete()&&o++}),o+" of "+n.tasks().length+" today"}),n.tasksYesterday=ko.computed(function(){return n.yesterdayComplete+" of "+n.previousTaskTotal+" yesterday"}),n.addTask=function(){n.tasks.push(new Task(Math.random()*(1e15-1)+1,"",!1,!1))},n.removeTask=function(e){n.tasks.remove(e)},n.store=function(){var e=n.toJSON(),e=JSON.stringify(e);localStorage.setItem(t,e)}}void 0!==window.localStorage&&void 0!==window.sessionStorage||!function(){function e(t){function o(e,t,o){var n,o=o?((n=new Date).setTime(n.getTime()+24*o*60*60*1e3),"; expires="+n.toGMTString()):"";document.cookie=e+"="+t+o+"; path=/"}function n(e){e=JSON.stringify(e),"session"==t?window.name=e:o("localStorage",e,365)}var e,a=(e="session"==t?window.name:function(e){for(var t,o=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(t=n[a];" "==t.charAt(0);)t=t.substring(1,t.length);if(0==t.indexOf(o))return t.substring(o.length,t.length)}return null}("localStorage"))?JSON.parse(e):{};return{length:0,clear:function(){a={},this.length=0,"session"==t?window.name="":o("localStorage","",365)},getItem:function(e){return void 0===a[e]?null:a[e]},key:function(e){var t,o=0;for(t in a){if(o==e)return t;o++}return null},removeItem:function(e){delete a[e],this.length--,n(a)},setItem:function(e,t){a[e]=t+"",this.length++,n(a)}}}void 0===window.localStorage&&(window.localStorage=new e("local")),void 0===window.sessionStorage&&(window.sessionStorage=new e("session"))}(),ko.bindingHandlers.store={update:function(e,t,o,n){t=t(),o(),ko.utils.unwrapObservable(t),o=n.id();localStorage.setItem(o,ko.toJSON(n)),App.store()}},AppModel.prototype.toJSON=function(){return ko.toJS(this)},function(e){"use strict";App=new function(){var o;return{log:function(e){console},init:function(e){var t=window.localStorage.getItem(e),t=JSON.parse(t);o=new AppModel(t,e),ko.applyBindings(o)},store:function(){o.store()},status:function(){return ko.toJSON(o)},newDate:function(){return new Date},addTask:function(){o.addTask(),e(".task > input").last().focus()}}}}(jQuery);